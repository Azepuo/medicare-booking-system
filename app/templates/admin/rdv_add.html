{% extends 'admin/base.html' %}
{% block title %}HealthAdmin - Rendez-vous{% endblock %}
{% block content %}

<!-- SIDEBAR -->
<section id="sidebar">
    <a href="#" class="brand">
        <i class='bx bxs-smile'></i>
        <span class="text">HealthAdmin</span>
    </a>

    <ul class="side-menu top">
        <li><a href="/admin/dashboard"><i class='bx bxs-dashboard'></i><span class="text">Dashboard</span></a></li>
        <li><a href="/admin/medecins"><i class='bx bxs-user-pin'></i><span class="text">Médecin</span></a></li>
        <li><a href="/admin/patients"><i class='bx bx-user'></i><span class="text">Patients</span></a></li>
        <li class="active"><a href="/admin/rendez_vous"><i class='bx bxs-calendar'></i><span
                    class="text">Rendez-vous</span></a></li>
        <li><a href="/admin/facturation"><i class='bx bxs-receipt'></i><span class="text">Facturation</span></a>
        </li>
    </ul>

    <ul class="side-menu">
        <li><a href="/admin/account"><i class='bx bxs-id-card'></i><span class="text">Mon compte</span></a></li>
        <li><a href="http://127.0.0.1:5000/logout" class="logout">
                <i class='bx bxs-log-out-circle'></i>
                <span class="text">Déconnexion</span>
            </a>
        </li>
    </ul>
</section>
<!-- SIDEBAR -->

<!-- CONTENT -->
<section id="content">

    <!-- NAVBAR -->
    <nav>
        <form action="#">
            <!-- <div class="form-input">
                    <input type="search" placeholder="Search...">
                    <button type="submit" class="search-btn"><i class='bx bx-search'></i></button>
                </div> -->
        </form>
        <input type="checkbox" id="switch-mode" hidden>
        <label for="switch-mode" class="switch-mode"></label>
        <a href="#" class="profile">
            <img src="{{ url_for('static', filename='uploads/' ~ admin.photo) }}">

        </a>
    </nav>
    <!-- NAVBAR -->

    <!-- MAIN -->
    <main>
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div class="flash-container">
            {% for category, message in messages %}
            <div class="alert {{ category }}">{{ message }}</div>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}

        <div class="head-title">
            <div class="left">
                <h1>
                    {% if rdv %}
                    Modifier un rendez-vous
                    {% else %}
                    Ajouter un rendez-vous
                    {% endif %}
                </h1>

                <ul class="breadcrumb">
                    <li><a href="/admin/dashboard">Dashboard</a></li>
                    <li><i class='bx bx-chevron-right'></i></li>
                    <li><a href="/admin/rendez_vous">Rendez-vous</a></li>
                    <li><i class='bx bx-chevron-right'></i></li>
                    <li><a class="active">{% if rdv %}Modifier{% else %}Ajouter{% endif %}</a></li>
                </ul>
            </div>
        </div>

        <div class="form-wrapper">
            <div class="form-card form-card-medium">

                <!-- ✅ ACTION CORRECTE -->
                <form method="POST"
                    action="{{ url_for('rdv_bp.ajouter_rdv') if not rdv else url_for('rdv_bp.editer_rdv', rdv_id=rdv.id) }}">

                    <div class="form-grid">

                        <!-- ✅ Patient -->
                        <div class="field">
                            <label for="patient_id">Patient</label>
                            <select id="patient_id" name="patient_id" required>
                                <option value="">-- Sélectionner un patient --</option>
                                {% for p in patients %}
                                <option value="{{ p.id }}" {% if rdv and rdv.patient_id==p.id %}selected{% endif %}>
                                    {{ p.nom }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>

                        <!-- ✅ Médecin -->
                        <div class="field">
                            <label for="medecin_id">Médecin</label>
                            <select id="medecin_id" name="medecin_id" required>
                                <option value="">-- Sélectionner un médecin --</option>
                                {% for m in medecins %}
                                <option value="{{ m.id }}" {% if rdv and rdv.medecin_id==m.id %}selected{% endif %}>
                                    Dr. {{ m.nom }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>

                        <!-- ✅ Date -->
                        <div class="field">
                            <label for="date_rdv">Date</label>
                            <input type="date" id="date_rdv" name="date_rdv" required>
                        </div>


                        <!-- ✅ Heure -->
                        <div class="field">
                            <label for="heure_rdv">Heure</label>
                            <input type="time" id="heure_rdv" name="heure_rdv"
                                value="{{ rdv.heure_rdv if rdv else '' }}" required>
                        </div>

                        <!-- ✅ Statut -->
                        <div class="field">
                            <label for="statut">Statut</label>
                            <select id="statut" name="statut">
                                <option value="en_attente" {% if rdv and rdv.statut=='en_attente' %}selected{% endif %}>
                                    En attente</option>
                                <option value="Terminé" {% if rdv and rdv.statut=='terminé' %}selected{% endif %}>
                                    Terminé</option>
                                <option value="annule" {% if rdv and rdv.statut=='annule' %}selected{% endif %}>
                                    Annulé</option>
                            </select>
                        </div>

                        <!-- ✅ Notes -->
                        <div class="field field-full">
                            <label for="notes">Motif / Notes</label>
                            <textarea id="notes" name="notes" rows="3">{{ rdv.notes if rdv else '' }}</textarea>
                        </div>

                    </div>

                    <div class="form-actions">
                        <a href="/admin/rendez_vous" class="btn-secondary">Annuler</a>
                        <button type="submit" class="btn-primary">
                            {% if rdv %}Enregistrer{% else %}Ajouter le rendez-vous{% endif %}
                        </button>
                    </div>

                </form>

            </div>
        </div>
    </main>

</section>

</section>

{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/rdv.js') }}"></script>
{% endblock %}


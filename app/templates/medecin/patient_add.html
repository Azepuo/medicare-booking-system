{% extends 'medecin/base.html' %}

{% block title %}Ajouter Patient • Médecin{% endblock %}

{% block content %}
<div class="card">
  <h2>Ajouter un patient</h2>
  <form id="patientAddForm">
    <div class="form-group">
      <label>Nom complet *</label>
      <input name="nom" id="nom" class="input" required>
    </div>
    <div class="form-group">
      <label>Email *</label>
      <input name="email" id="email" type="email" class="input" required>
    </div>
    <div class="form-group">
      <label>Téléphone</label>
      <input name="telephone" id="telephone" class="input">
    </div>
    <div style="display:flex; gap:10px;">
      <button type="submit" class="btn primary">Enregistrer</button>
      <a href="/medecin/patients" class="btn secondary">Annuler</a>
    </div>
  </form>
</div>
{% endblock %}

{% block scripts %}
<script>
document.getElementById('patientAddForm').addEventListener('submit', async function(e){
  e.preventDefault();
  
  const payload = {
    nom: document.getElementById('nom').value,
    email: document.getElementById('email').value,
    telephone: document.getElementById('telephone').value
  };

  try {
    const res = await fetch('/medecin/api/patients', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify(payload)
    });
    
    if (!res.ok) {
      const errorData = await res.json();
      throw new Error(errorData.error || 'Erreur lors de la création');
    }
    
    const result = await res.json();
    alert('✅ ' + (result.message || 'Patient créé avec succès !'));
    window.location.href = '/medecin/patients';
    
  } catch (error) {
    console.error('Erreur création patient:', error);
    alert('❌ Erreur: ' + error.message);
  }
});
</script>
{% endblock %}
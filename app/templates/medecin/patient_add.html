{% extends 'medecin/base.html' %}

{% block title %}Ajouter Patient • Médecin{% endblock %}

{% block content %}
<div class="card">
  <h2>Ajouter un patient</h2>

  <form id="patientAddForm">

    <div class="form-group">
      <label>Nom complet *</label>
      <input id="nom" class="input" required>
    </div>

    <div class="form-group">
      <label>Email *</label>
      <input id="email" type="email" class="input" required>
    </div>

    <div class="form-group">
      <label>Téléphone</label>
      <input id="telephone" class="input">
    </div>

    <div class="form-group">
      <label>Sexe *</label>
      <select id="sexe" class="input" required>
        <option value="">Sélectionner...</option>
        <option value="Homme">Homme</option>
        <option value="Femme">Femme</option>
      </select>
    </div>

    <div style="display:flex; gap:10px; margin-top:15px;">
      <button type="submit" class="btn primary">Enregistrer</button>
      <a href="/medecin/patients" class="btn secondary">Annuler</a>
    </div>

  </form>
</div>
{% endblock %}

{% block scripts %}
<script>
document.getElementById('patientAddForm').addEventListener('submit', async e => {
  e.preventDefault();

  const payload = {
    nom: document.getElementById('nom').value.trim(),
    email: document.getElementById('email').value.trim(),
    telephone: document.getElementById('telephone').value.trim(),
    sexe: document.getElementById('sexe').value
  };

  if (!payload.nom || !payload.email || !payload.sexe) {
    alert('❌ Tous les champs obligatoires doivent être remplis');
    return;
  }

  try {
    const res = await fetch('/medecin/api/patients', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify(payload)
    });

    const data = await res.json();

    if (!res.ok) {
      throw new Error(data.error || 'Erreur lors de la création du patient');
    }

    alert('✅ Patient créé avec succès');
    window.location.href = '/medecin/patients';

  } catch (err) {
    console.error(err);
    alert('❌ ' + err.message);
  }
});
</script>
{% endblock %}
